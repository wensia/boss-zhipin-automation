# Electron 桌面版 - 项目说明

## 📌 项目概述

这是 **Boss直聘自动化工具** 的 Mac 桌面版打包方案，使用 Electron 技术将 Web 应用打包成独立的桌面应用程序。

## 🎯 解决的问题

### 现状
- 用户需要安装 Python、Node.js、uv 等开发工具
- 需要手动启动后端和前端服务
- 需要在浏览器中访问
- 不适合非技术用户使用

### 桌面版优势
- ✅ **开箱即用**：双击即可运行，无需安装任何依赖
- ✅ **原生体验**：像使用普通 Mac 应用一样
- ✅ **自动管理**：自动启动后端服务，无需手动操作
- ✅ **易于分享**：发送 .dmg 文件即可分享给他人
- ✅ **独立运行**：不依赖系统环境

## 🏗️ 技术架构

```
┌─────────────────────────────────────┐
│         Electron 主进程              │
│  (main.js)                          │
│                                     │
│  ┌──────────┐      ┌──────────┐   │
│  │ 启动后端  │      │ 创建窗口  │   │
│  │ Python   │      │ BrowserView│   │
│  └──────────┘      └──────────┘   │
│       │                  │          │
└───────┼──────────────────┼──────────┘
        │                  │
        ▼                  ▼
┌──────────────┐   ┌──────────────┐
│  FastAPI     │   │  React 前端   │
│  后端服务     │◄──│  (已构建)    │
│  (打包后)     │   │              │
└──────────────┘   └──────────────┘
```

## 📂 文件结构

```
electron-app/
├── 📄 package.json          # Electron 项目配置
├── 📄 main.js              # 主进程（管理后端和窗口）
├── 📄 preload.js           # 预加载脚本（安全桥接）
├── 📄 README.md            # 详细使用文档
├── 📄 快速测试指南.md       # 测试步骤
├── 📄 start-dev.sh         # 开发模式启动脚本
│
├── 📁 scripts/
│   └── build-backend.js    # 后端打包脚本（PyInstaller）
│
├── 📁 assets/
│   └── icon.icns          # 应用图标（需自行添加）
│
└── 📁 dist/               # 打包产物（自动生成）
    ├── Boss直聘自动化-1.0.0-arm64.dmg
    └── Boss直聘自动化.app
```

## 🔄 两种运行模式

### 1. 开发模式（Development）

**用途：** 测试 Electron 功能，不影响现有开发

**特点：**
- 连接到现有的后端服务（localhost:27421）
- 连接到现有的前端服务（localhost:13601）
- 支持热重载
- 可以同时使用浏览器和桌面版

**启动方式：**
```bash
./start-dev.sh
# 或
npm start
```

### 2. 生产模式（Production）

**用途：** 打包成独立应用分发给他人

**特点：**
- 内嵌所有依赖（Python、Node.js 环境）
- 前后端已打包成静态文件
- 独立运行，无需外部服务
- 生成 .dmg 安装包

**构建方式：**
```bash
npm run build
```

## 📊 与原项目的关系

```
Boss直聘自动化/
├── backend/           ← 原后端项目（不变）
├── frontend/          ← 原前端项目（不变）
└── electron-app/      ← 新增的打包方案（独立）
```

### 重要说明

1. **完全独立**
   - `electron-app/` 是独立的打包方案
   - 不会修改 `backend/` 或 `frontend/` 的任何代码
   - 不影响原有的开发流程

2. **开发流程不变**
   - 继续在 `backend/` 和 `frontend/` 中开发
   - 测试通过后，在 `electron-app/` 中打包
   - 打包失败不影响原项目

3. **代码复用**
   - 开发模式：直接使用运行中的服务
   - 生产模式：构建时从原项目复制文件

## 🚀 使用场景

### 场景 1：自己使用（开发模式）

```bash
# 像平时一样启动服务
cd backend && uv run python -m app.main
cd frontend && npm run dev

# 启动桌面版测试
cd electron-app && ./start-dev.sh
```

### 场景 2：分享给朋友（生产模式）

```bash
# 构建桌面版
cd electron-app
npm run build

# 发送 DMG 文件给朋友
# dist/Boss直聘自动化-1.0.0-arm64.dmg
```

朋友收到后：
1. 双击 .dmg 文件
2. 拖拽应用到"应用程序"文件夹
3. 双击运行，无需任何配置

## 🎨 定制化

### 修改应用名称

在 `package.json` 中修改：
```json
{
  "build": {
    "productName": "你的应用名称"
  }
}
```

### 修改应用图标

1. 准备 1024x1024 的 PNG 图片
2. 转换为 .icns 格式（使用在线工具）
3. 放到 `assets/icon.icns`

### 修改端口

在 `main.js` 中修改：
```javascript
const BACKEND_PORT = 27421;
const FRONTEND_PORT = 13601;
```

## 📦 打包产物说明

### DMG 文件
- **用途：** Mac 安装包
- **大小：** 约 150-200MB
- **包含：** 应用本身 + Python 运行时 + 所有依赖
- **分发方式：** 直接发送给他人

### APP 文件
- **用途：** Mac 应用程序
- **位置：** `dist/mac-arm64/Boss直聘自动化.app`
- **使用：** 可直接运行，或拖入"应用程序"文件夹

## 🔒 安全说明

### Mac 安全提示

用户首次打开可能看到"无法打开，因为来自身份不明的开发者"。

**解决方法：**
1. 右键点击应用，选择"打开"
2. 或在终端执行：
   ```bash
   xattr -cr "/Applications/Boss直聘自动化.app"
   ```

### 代码签名（可选）

如需正式分发，建议进行代码签名：

**要求：**
- Apple Developer 账号（$99/年）
- Developer ID 证书

**签名命令：**
```bash
codesign --deep --force --sign "Developer ID Application: Your Name" \
  "Boss直聘自动化.app"
```

## 📈 性能优化

### 减小应用体积

1. **移除不必要的依赖**
   ```json
   // package.json - 只保留必需的
   "dependencies": {}
   ```

2. **优化后端打包**
   ```javascript
   // 在 build-backend.js 中添加
   --exclude-module pytest
   --exclude-module black
   ```

3. **启用 asar 压缩**
   ```json
   "build": {
     "asar": true
   }
   ```

### 提升启动速度

1. 使用 `--onefile` 打包后端（已配置）
2. 优化前端构建（Tree shaking）
3. 延迟加载非关键资源

## 🧪 测试清单

在分发给他人前，请测试：

- [ ] 应用能正常启动
- [ ] 后端服务自动运行
- [ ] 前端界面正常显示
- [ ] 登录功能正常
- [ ] 任务创建和执行正常
- [ ] 关闭应用后后端服务正确退出
- [ ] 在新 Mac 上测试（无开发环境）

## 📚 参考资料

- [Electron 官方文档](https://www.electronjs.org/docs/latest)
- [electron-builder 文档](https://www.electron.build/)
- [PyInstaller 文档](https://pyinstaller.org/)

## 🤝 贡献

欢迎提出改进建议！

## 📄 许可证

MIT

---

**总结：** 这是一个完全独立的打包方案，让你能将 Web 应用轻松分享给其他 Mac 用户，同时不影响原有的开发流程。
