# Boss直聘自动打招呼 - 完整流程测试指南

## 🎯 功能说明

系统已修复为**复用浏览器会话**模式，用户在向导中初始化的浏览器会被打招呼功能直接使用，不会创建新窗口或跳转页面。

## 📋 完整测试流程

### 步骤1：启动服务

```bash
# Terminal 1: Backend
cd backend
uv run python -m app.main

# Terminal 2: Frontend
cd frontend
npm run dev
```

### 步骤2：访问自动化向导

**URL**: `http://localhost:13602/wizard`

#### 2.1 初始化浏览器
- 选择显示模式（不勾选"隐藏浏览器窗口"）
- 点击"初始化浏览器"
- 等待浏览器打开

#### 2.2 登录Boss直聘
- 等待二维码显示
- 使用Boss直聘APP扫码登录
- 等待登录成功提示

#### 2.3 选择职位
- 从下拉列表选择要招聘的职位
- 点击"选择职位"
- 等待跳转到推荐页面

#### 2.4 配置筛选条件（可选）
- 设置学历、经验、年龄等筛选条件
- 点击"应用筛选"
- 等待筛选应用成功

#### 2.5 完成向导
- 此时浏览器应该停留在**推荐候选人页面**
- 可以看到候选人列表（ul > li 结构）

### 步骤3：访问自动打招呼页面

**URL**: `http://localhost:13602/greeting`

#### 3.1 输入数量
- 在"打招呼数量"输入框输入 `5`（建议先用小数量测试）

#### 3.2 点击开始
- 点击"开始"按钮
- **观察重点**：浏览器窗口**不会跳转或创建新窗口**
- **应该直接在当前的推荐候选人页面操作**

#### 3.3 观察执行过程

**浏览器中应该看到**：
1. 候选人卡片被点击（高亮）
2. 简历弹窗从右侧滑出
3. 打招呼按钮被点击
4. 按钮变为"继续沟通"
5. 简历弹窗关闭
6. 自动点击下一个候选人卡片
7. 重复上述流程

**Web界面应该显示**：
```
✅ 使用已打开的浏览器
✅ 找到推荐页面iframe
📍 处理第 1/5 个候选人
点击候选人: 张三
✅ 简历面板已加载
找到按钮: '打招呼'
✅ 已点击【打招呼】按钮
✅ 已关闭简历面板
✅ 候选人 1 处理成功
📍 处理第 2/5 个候选人
...
```

#### 3.4 查看统计
- 成功数：绿色显示
- 失败数：红色显示（可能因为已打过招呼）
- 进度条实时更新
- 耗时统计

## ✅ 验证要点

### 1. 浏览器复用验证
- ✅ 点击"开始"后，**浏览器窗口不变**
- ✅ 不会打开新的Chrome窗口
- ✅ 不会跳转到其他页面
- ✅ 直接在当前推荐页面操作候选人列表

### 2. 操作流程验证
- ✅ 自动点击候选人卡片（ul.candidate-list > li）
- ✅ 简历弹窗在recommendFrame中打开
- ✅ 找到并点击打招呼按钮
- ✅ 点击右上角关闭按钮
- ✅ 返回候选人列表继续下一个

### 3. 状态同步验证
- ✅ 进度条实时更新
- ✅ 日志每秒刷新
- ✅ 统计数据准确
- ✅ 任务完成后自动停止

## 🐛 常见问题

### 问题1：提示"未登录，请先在向导中完成登录"
**原因**：没有先在向导中登录
**解决**：访问 `/wizard` 完成登录流程

### 问题2：提示"浏览器未初始化"
**原因**：没有先在向导中初始化浏览器
**解决**：访问 `/wizard` 点击"初始化浏览器"

### 问题3：提示"未找到recommendFrame"
**原因**：浏览器不在推荐候选人页面
**解决**：在向导中选择职位后确保停留在推荐页面

### 问题4：打招呼按钮未找到
**原因**：可能该候选人已经打过招呼
**结果**：系统会跳过并继续下一个，这是正常的

### 问题5：浏览器跳转到其他页面
**原因**：可能是旧版本代码或缓存问题
**解决**：
```bash
# 重启Backend
cd backend
pkill -f "python -m app.main"
uv run python -m app.main

# 刷新前端页面（Ctrl+Shift+R 清除缓存）
```

## 📊 性能指标

| 指标 | 预期值 |
|------|--------|
| 响应时间 | < 1秒 |
| 成功率 | ≥ 80% |
| 平均速度 | 8-12秒/人 |
| 5人耗时 | ~50秒 |
| 10人耗时 | ~100秒 |

## 🔧 调试模式

如果需要查看详细日志：

```bash
# Backend日志
tail -f backend/backend_final.log

# 或使用Python日志
cd backend
uv run python -m app.main

# 前端控制台
# 浏览器按F12，查看Console和Network标签
```

## 📝 API测试命令

如果需要直接测试API：

```bash
# 1. 初始化浏览器
curl -X POST http://localhost:27421/api/automation/init \
  -H "Content-Type: application/json" \
  -d '{"headless": false}'

# 2. 检查自动化服务状态
curl http://localhost:27421/api/automation/status

# 3. 获取二维码
curl http://localhost:27421/api/automation/qrcode

# 4. 检查登录状态
curl http://localhost:27421/api/automation/check-login

# 5. 获取职位列表
curl http://localhost:27421/api/automation/available-jobs

# 6. 选择职位
curl -X POST http://localhost:27421/api/automation/select-job \
  -H "Content-Type: application/json" \
  -d '{"job_value": "职位ID"}'

# 7. 开始打招呼（确保在推荐页面）
curl -X POST http://localhost:27421/api/greeting/start \
  -H "Content-Type: application/json" \
  -d '{"target_count": 5}'

# 8. 查看打招呼状态
curl http://localhost:27421/api/greeting/status

# 9. 查看日志
curl http://localhost:27421/api/greeting/logs?last_n=20
```

## 🎬 成功示例

**日志输出**：
```
🚀 开始打招呼任务，目标数量: 5
✅ 使用已打开的浏览器
开始处理 5 个候选人...
✅ 找到推荐页面iframe

📍 处理第 1/5 个候选人
点击候选人: 张三 - 前端工程师
✅ 简历面板已加载
找到按钮: '打招呼'
✅ 已点击【打招呼】按钮
✅ 已关闭简历面板
✅ 候选人 1 处理成功

📍 处理第 2/5 个候选人
点击候选人: 李四 - React开发
✅ 简历面板已加载
找到按钮: '打招呼'
✅ 已点击【打招呼】按钮
✅ 已关闭简历面板
✅ 候选人 2 处理成功

...

🎉 任务完成！
✅ 成功: 5/5
❌ 失败: 0/5
⏱️  耗时: 47.2秒
```

## 🎯 核心优势

1. **无缝集成**：向导配置 → 直接打招呼，无需重新初始化
2. **状态保持**：职位选择、筛选条件全部保留
3. **快速执行**：无需等待页面跳转和重新登录
4. **资源高效**：单一浏览器进程，降低内存占用
5. **用户友好**：符合直觉，操作流畅

---

**测试人员**: 请按照此流程完整测试一遍，记录任何异常情况
**开发者**: 修复完成，已验证浏览器复用功能正常
**日期**: 2025-10-29
